<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>generate a score hic track based on observed and expected (shuffled) hic data — shaman_score_hic_track • shaman</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">


<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script>
<script src="../pkgdown.js"></script>
  
  
<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">shaman</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">Home</a>
</li>
<li>
  <a href="../articles/shaman-package.html">
    <span class="fa fa-road"></span>
     
    Usage
  </a>
</li>
<li>
  <a href="../articles/import.html">
    <span class="fa fa-filter"></span>
     
    Import
  </a>
</li>
<li>
  <a href="../reference/index.html">
    <span class="fa fa-th-list"></span>
     
    Reference
  </a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://bitbucket.org/tanaylab/shaman">
    <span class="fa fa-bitbucket-square"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

      <div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>generate a score hic track based on observed and expected (shuffled) hic data</h1>
    </div>

    
    <p><code>shaman_score_hic_track</code></p>
    

    <pre class="usage"><span class='fu'>shaman_score_hic_track</span>(<span class='no'>track_db</span>, <span class='no'>work_dir</span>, <span class='no'>score_track_nm</span>, <span class='no'>obs_track_nms</span>,
  <span class='kw'>exp_track_nms</span> <span class='kw'>=</span> <span class='fu'>paste0</span>(<span class='no'>obs_track_nms</span>, <span class='st'>"_shuffle"</span>),
  <span class='kw'>points_track_nms</span> <span class='kw'>=</span> <span class='no'>obs_track_nms</span>, <span class='kw'>near_cis</span> <span class='kw'>=</span> <span class='fl'>5e+06</span>, <span class='kw'>expand</span> <span class='kw'>=</span> <span class='fl'>2e+06</span>,
  <span class='kw'>k</span> <span class='kw'>=</span> <span class='fl'>100</span>, <span class='kw'>max_jobs</span> <span class='kw'>=</span> <span class='fl'>100</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a> Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>track_db</th>
      <td><p>Directory of the misha database.</p></td>
    </tr>
    <tr>
      <th>work_dir</th>
      <td><p>Centralized directory to store temporary files.</p></td>
    </tr>
    <tr>
      <th>score_track_nm</th>
      <td><p>Score track that will be created.</p></td>
    </tr>
    <tr>
      <th>obs_track_nms</th>
      <td><p>Names of observed 2D genomic tracks for the hic data. Pooling of multiple
observed tracks is supported.</p></td>
    </tr>
    <tr>
      <th>exp_track_nms</th>
      <td><p>Names of expected (shuffled) 2D genomic tracks. Pooling of multiple expected
tracks is supported.</p></td>
    </tr>
    <tr>
      <th>points_track_nms</th>
      <td><p>Names of 2D genomic tracks that contain points on which to compute
normalized score. Pooling points from multiple tracks is supported.</p></td>
    </tr>
    <tr>
      <th>near_cis</th>
      <td><p>Size of matrix in grid.</p></td>
    </tr>
    <tr>
      <th>expand</th>
      <td><p>Size of expansion, points to include outside the matrix for accurate computing of the score.
Note that for each observed point, its k-nearest neighbors must be included in the expanded matrix.</p></td>
    </tr>
    <tr>
      <th>k</th>
      <td><p>The number of neighbor distances used for the score. For higher resolution maps, increase k. For
lower resolution maps, decrease k.</p></td>
    </tr>
    <tr>
      <th>max_jobs</th>
      <td><p>Maximal number of qsub jobs.</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>This function generates a 2D score track based on observed and expected hic data.
The score is computed by generating a grid of small matrices spanning all chromosomes
and computing the score of each matrix independantly.
The model for computing the score relies on the KS D statistic computed for each observed point,
over the distances of the k-nearest neighbors in the observed compared to the expected.
High scores represent contact enrichment while low scores depict insulation.
Note that this function requires either sge (qsub) or multicore to compute in a timely manner.
Parameters can be set via shaman.sge_support or shaman.mc_support in shaman.conf file.
Score computation on 1 billion reads on a distributed system may take 4-10 hours (with default parameters), 
depending on the number of cores available.</p>
<p>Each step creates temporary files of the matrix scores which are then joined to a track.
Temporary files are deleted upon track creation.</p>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'>
<span class='co'># The example below runs on the test misha db provided with shaman.</span>
<span class='co'># Note that this is a toy db sampled from K562 ela data -</span>
<span class='co'># scoring based on the observed and expected tracks will not produce the score track,</span>
<span class='co'># as most of the genome is missing (you will see message: number of points in focus interval &lt; 1000)</span>
<span class='co'># options(shaman.sge_support=1) #configuring sge engine mode - preferred</span>
<span class='fu'>options</span>(<span class='kw'>shaman.mc_support</span><span class='kw'>=</span><span class='fl'>1</span>)    <span class='co'>#configuring multi-core mode</span>
<span class='kw'>if</span> (<span class='fu'>gtrack.exists</span>(<span class='st'>"hic_score_new"</span>)) {
    <span class='fu'>gtrack.rm</span>(<span class='st'>"hic_score_new"</span>, <span class='kw'>force</span><span class='kw'>=</span><span class='fl'>TRUE</span>)
    <span class='fu'>gdb.reload</span>()
}
<span class='no'>ret</span> <span class='kw'>&lt;-</span> <span class='fu'>shaman_score_hic_track</span>(<span class='fu'><a href='shaman_get_test_track_db.html'>shaman_get_test_track_db</a></span>(),
<span class='kw'>work_dir</span><span class='kw'>=</span><span class='fu'>tempdir</span>(),               <span class='co'># this can be set only in multi-core mode. For sge mode, work_dir must be accessible by all jobs.</span>
<span class='kw'>score_track_nm</span><span class='kw'>=</span><span class='st'>"hic_score_new"</span>,
<span class='kw'>obs_track_nms</span><span class='kw'>=</span><span class='st'>"hic_obs"</span>,
<span class='kw'>exp_track_nms</span><span class='kw'>=</span><span class='st'>"hic_exp"</span>,
        <span class='kw'>near_cis</span><span class='kw'>=</span><span class='fl'>1e09</span>,                    <span class='co'># this test db contains very little data, can increase the size of each job</span>
<span class='kw'>max_jobs</span><span class='kw'>=</span><span class='kw pkg'>parallel</span><span class='kw ns'>::</span><span class='fu'><a href='http://www.rdocumentation.org/packages/parallel/topics/detectCores'>detectCores</a></span>()) <span class='co'># increase number of jobs for optimal runtime when running in sge mode</span></div><div class='output co'>#&gt; <span class='message'>missing 24 score files</span></div><div class='output co'>#&gt; <span class='message'>missing 0 score files</span></div><div class='output co'>#&gt; Reading input file(s)...
#&gt; 17%...38%...62%...85%...100%
#&gt; Writing the track...
#&gt; 8%...30%...52%...69%...91%...100%</div><div class='input'><span class='fu'>gdb.reload</span>()
<span class='fu'>gtrack.ls</span>(<span class='st'>"hic_score_new"</span>) <span class='co'>#new shuffled track that was created</span></div><div class='output co'>#&gt; [1] "hic_score_new"</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#details">Details</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Amos Tanay, Netta Mendelson Cohen.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  </body>
</html>
